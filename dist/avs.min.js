var AVS=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.r(t),n.d(t,"default",function(){return c});var o=function(e,t){e.onopen=function(){t.send({event:"peer_connected",data:{peer_id:e.id}})},e.onmessage=function(n){var i=JSON.parse(n.data);console.log("receive",i),i.event&&i.data&&function(n,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;switch(n){case"peer_connected":!function(n){var i=new RTCPeerConnection(t.config);i.peer_id=n,a(i,t),t.streaming&&(i.addStream(t.stream),i.createOffer().then(function(e){return i.setLocalDescription(e)}).then(function(){t.send({event:"receive_offer",to:n,data:{peer_id:e.id,message:i.localDescription}})}));t.peers.push(i),t.send({event:"connected_to_peer",to:n,data:{peer_id:e.id}})}(i.peer_id);break;case"connected_to_peer":e.id==r&&(s=i.peer_id,(d=new RTCPeerConnection(t.config)).peer_id=s,a(d,t),t.peers.push(d));break;case"receive_offer":e.id==r&&function(n,i){t.peers.forEach(function(e){e.getSenders().forEach(function(t){e.removeTrack(t)})});var r=t.peers.find(function(e){return e.peer_id==n});r.setRemoteDescription(i).then(function(){return r.createAnswer()}).then(function(e){return r.setLocalDescription(e)}).then(function(){t.send({event:"receive_answer",to:r.peer_id,data:{peer_id:e.id,message:r.localDescription}})})}(i.peer_id,i.message);break;case"receive_answer":e.id==r&&(o=i.peer_id,c=i.message,t.peers.find(function(e){return e.peer_id==o}).setRemoteDescription(c));break;case"add_candidate":e.id==r&&function(e,n){t.peers.find(function(t){return t.peer_id==e}).addIceCandidate(n)}(i.peer_id,i.message)}var o,c;var s,d}(i.event,i.data,i.to)}},a=function(e,t){e.ontrack=function(e){t.videoElem.srcObject=e.streams[0],t.videoElem.play().then().catch(function(e){console.error("Media cannot be played automatically without user interaction with page.",e)})},e.onicecandidate=function(n){n.candidate&&n.candidate.candidate&&t.send({event:"add_candidate",to:e.peer_id,data:{peer_id:t.socket.id,message:n.candidate}})}},c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r(this,"_version",.01),r(this,"room",void 0),r(this,"stream",void 0),r(this,"streaming",!1),r(this,"socket",void 0),r(this,"peers",[]),r(this,"videoElem",void 0),r(this,"config",{iceServers:[]}),this.socket=new WebSocket(t.wss),this.socket.id=Math.random().toString().slice(2),o(this.socket,this),this.videoElem=t.videoElem||document.getElementById("viewBroadcast"),this.config={iceServers:t.iceServers||[]},this.room=t.room}var t,n,a;return t=e,(n=[{key:"shareScreen",value:function(){var e=this;navigator.getDisplayMedia?navigator.getDisplayMedia().then(function(t){e.startStreaming(t)}):navigator.mediaDevices.getDisplayMedia&&navigator.mediaDevices.getDisplayMedia().then(function(t){e.startStreaming(t)})}},{key:"startStreaming",value:function(e){var t=this;this.stream=e,this.streaming=!0,this.videoElem&&(this.videoElem.srcObject=e,this.videoElem.play()),this.peers.forEach(function(e){e.addStream(t.stream),e.createOffer().then(function(t){return e.setLocalDescription(t)}).then(function(){t.send({event:"receive_offer",to:e.peer_id,data:{peer_id:t.socket.id,message:e.localDescription}})})})}},{key:"send",value:function(e){console.log("send",e),this.socket.send(JSON.stringify({message_type:"MESSAGE_BROADCAST",message_details:e}))}}])&&i(t.prototype,n),a&&i(t,a),e}()}]).default;
//# sourceMappingURL=avs.min.js.map